#!/usr/bin/env python
# Copyright 2017 The Chromium Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

"""Exports local changes to web-platform-tests in Chromium to upstream repo.

This script checks LayoutTests/external/wpt for changes that can be exported,
then creates a patch, and creates and lands a pull request for the upstream
repository.
"""

import argparse
import logging

from webkitpy.common.host import Host
from webkitpy.w3c.test_exporter import TestExporter
from webkitpy.w3c.wpt_github import WPTGitHub


_log = logging.getLogger(__name__)


def main():
    logging.basicConfig(level=logging.INFO, format='%(message)s')

    parser = argparse.ArgumentParser(description=__doc__)
    parser.add_argument(
        '--dry-run', action='store_true',
        help='See what would be done without actually creating or merging '
             'any pull requests.')
    parser.add_argument(
        '--user',
        help='GitHub user name. Can also be provided using the GH_USER '
             'environment variable.')
    parser.add_argument(
        '--token',
        help='GitHub token or password. Can also be provided using the GH_TOKEN '
             'environment variable.')
    args = parser.parse_args()
    host = Host()
    if not args.user:
        args.user = host.environ.get('GH_USER')
    if not args.token:
        args.token = host.environ.get('GH_TOKEN')
    if not (args.user and args.token):
        parser.error('Must provide both user and token for GitHub.')

    wpt_github = WPTGitHub(host, args.user, args.token)
    test_exporter = TestExporter(host, wpt_github, dry_run=args.dry_run)

    test_exporter.run()


if __name__ == '__main__':
    main()
